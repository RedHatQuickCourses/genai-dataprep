<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Customizing Conversion Pipeline :: Data Preparation for Gen AI Applications</title>
    <link rel="prev" href="multi-format.html">
    <link rel="next" href="image-table.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Data Preparation for Gen AI Applications</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/genai-dataprep/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="genai-dataprep" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Data Preparation for Gen AI Applications</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../data-prep-intro.html">Data Preparation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../docling/index.html">Docling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/arch.html">Architecture &amp; Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/install.html">Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/cli.html">Docling CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/gui.html">Docling Web UI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/library.html">Docling Library</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Conversion</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="batch.html">Batch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="multi-format.html">Multi-format</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="custom.html">Customizing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="image-table.html">Images and Tables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="image-describe.html">Image Captions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chunking/index.html">Chunking &amp; Serialization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chunking/chunking.html">Why Chunking?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chunking/hybrid.html">Hybrid Chunking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chunking/serialization.html">Serialization</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rag/index.html">Retrieval Augmented Generation (RAG)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rag/rag.html">RAG</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rag/rag-lab.html">Lab: Data Preparation for RAG</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../dpk/index.html">Data Prep Kit (DPK)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dpk/dpk-lab.html">Labs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../reference/index.html">Other Misc Material</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Data Preparation for Gen AI Applications</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Data Preparation for Gen AI Applications</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Data Preparation for Gen AI Applications</a></li>
    <li><a href="index.html">Conversion</a></li>
    <li><a href="custom.html">Customizing</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Customizing Conversion Pipeline</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Docling provides sane defaults for converting many different type of documents. Many documents that you want to convert for LLM training or RAG will convert to a suitable format of your choice without too much customization. However, in some cases, you may wish to customize the Docling processing pipeline for conversion by using the Python library.</p>
</div>
<div class="paragraph">
<p>Common use-cases include using a different Optical Character Recognition (OCR) tool/library to convert a scanned PDF document, extract certain sections from documents while discrading the rest, automatic image captioning, image and table extraction, and many more options to programatically navigate the structure of the document hierarchy during the conversion process.</p>
</div>
<div class="paragraph">
<p>Docling allows you to do this by customizing the pipeline options classes provided by Docling. See <a href="https://docling-project.github.io/docling/reference/pipeline_options/" target="_blank" rel="noopener">Pipeline Options</a> for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The Docling Python library must be installed as outlined in the previous sections using <code>pip</code> in a Python virtual environment</p>
</li>
<li>
<p>Git CLI to clone the sample data files from GitHub</p>
</li>
<li>
<p>Visual Studio Code, or other editors to edit Python code</p>
</li>
<li>
<p>You will need to install the Tesseract OCR CLI and libraries</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_customizing_the_docling_conversion_pipeline"><a class="anchor" href="#_lab_customizing_the_docling_conversion_pipeline"></a>Lab: Customizing the Docling Conversion Pipeline</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done it, clone the Git repository containing the sample documents that should be converted, to a folder of your choice.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>git clone https://github.com/RedHatQuickCourses/genai-apps.git</strong></code></pre>
</div>
</div>
</li>
<li>
<p>All the sample input files and code is in a folder called <code>dataprep</code>. Change to this folder in the terminal.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cd genai-apps/dataprep</strong></code></pre>
</div>
</div>
</li>
<li>
<p>If you have previously created a virtual environment and installed Docling, activate the venv.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>source venv/bin/activate</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your prompt should change to indicate that you are now running in an isolated virtual environment.</p>
</div>
</li>
<li>
<p>Install the Tesseract OCR CLI and libraries for your platform by following the instructions at <a href="https://docling-project.github.io/docling/installation/" target="_blank" rel="noopener">Install Alternative OCR engines</a></p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Install the tesseract libraries using <code>pip install</code> only after you activate the virtual environment!
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/alt-ocr.png" alt="alt ocr">
</div>
<div class="title">Figure 1. Install Tesseract OCR</div>
</div>
<div class="paragraph">
<p>For example, on macOS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ (venv) brew install tesseract leptonica pkg-config
$ (venv) TESSDATA_PREFIX=/opt/homebrew/share/tessdata/
$ (venv) export "TESSDATA_PREFIX=${TESSDATA_PREFIX}"
$ (venv) pip install --no-binary :all: tesserocr==2.8.0</code></pre>
</div>
</div>
</li>
<li>
<p>Inspect the <code>custom-conversion.py</code> file in VS Code. The input document is in the <code>sample-data/custom</code> folder. The output documents will be placed in the <code>/tmp/custom-converted</code> folder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">INPUT_FILE = "sample-data/custom/doclaynet-paper.pdf"
OUTPUT_DIR = "/tmp/custom-converted"</code></pre>
</div>
</div>
</li>
<li>
<p>Scroll all the way to the bottom of the file. This file contains three methods demonstrating a default pipeline run, and pipeline customizations. The customization methods are commented out initially.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
if __name__ == "__main__":
    convert_default()
    #convert_pypdfium_backend()
    #convert_tesseract_ocr()
...</code></pre>
</div>
</div>
</li>
<li>
<p>Inspect the <code>convert_default()</code> method. It uses the default pipeline options with no customization.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
    <strong>pipeline_options = PdfPipelineOptions()</strong>

    doc_converter = DocumentConverter(
        format_options={
            InputFormat.PDF: PdfFormatOption(
                <strong>pipeline_options=pipeline_options</strong>
            )
        }
    )
...</code></pre>
</div>
</div>
</li>
<li>
<p>Run the program. You can safely ignore any warnings emitted.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>python3 custom-conversion.py</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Once the program completes, you should see the output Markdown file in the <code>/tmp/custom-converted</code> folder.</p>
</li>
<li>
<p>Next, inspect the <code>convert_pypdfium_backend()</code> method. Note the customization by setting various <code>pipeline_options</code> flags. Also note that we are using a different PDF conversion backend (<code>PyPdfium</code>) instead of the default PDF backend in Docling by taking advantage of Docling&#8217;s pluggable architecture.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
    <strong>pipeline_options = PdfPipelineOptions()
    pipeline_options.do_ocr = True
    pipeline_options.do_table_structure = True
    pipeline_options.table_structure_options.do_cell_matching = True
    pipeline_options.generate_picture_images = True</strong>

    doc_converter = DocumentConverter(
        format_options={
            InputFormat.PDF: PdfFormatOption(
                <strong>pipeline_options=pipeline_options,
                backend=PyPdfiumDocumentBackend</strong>
            )
        }
    )
...</code></pre>
</div>
</div>
</li>
<li>
<p>Finally, inspect the <code>def convert_tesseract_ocr()</code> method. We take advantage of the native Docling integration with the Tesseract OCR libraries and customize the pipeline to use it instead of the default OCR library in Docling (<code>EasyOCR</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
    pipeline_options = PdfPipelineOptions()
    ...
    <strong>pipeline_options.ocr_options = TesseractCliOcrOptions(
        force_full_page_ocr=True)</strong>
...</code></pre>
</div>
</div>
</li>
<li>
<p>Before running the script, uncomment the two method calls at the bottom of the file as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
if <em>name</em> == "<em>main</em>":
    convert_default()
    <strong>convert_pypdfium_backend()
    convert_tesseract_ocr()</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Run the script once again and verify the converted Markdown files in the <code>/tmp/custom-converted</code> folder. Experiment with different types of scanned PDF files to see the difference between the output from the different OCR libraries and backends.</p>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="multi-format.html">Multi-format</a></span>
  <span class="next"><a href="image-table.html">Images and Tables</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>

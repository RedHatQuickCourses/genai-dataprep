<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Parsing Documents with Images and Tables :: Data Preparation for Gen AI Applications</title>
    <link rel="prev" href="custom.html">
    <link rel="next" href="image-describe.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Data Preparation for Gen AI Applications</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/genai-dataprep/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="genai-dataprep" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Data Preparation for Gen AI Applications</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../data-prep-intro.html">Data Preparation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../docling/index.html">Docling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/arch.html">Architecture &amp; Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/install.html">Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/cli.html">Docling CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/gui.html">Docling Web UI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../docling/library.html">Docling Library</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Conversion</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="batch.html">Batch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="multi-format.html">Multi-format</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="custom.html">Customizing</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="image-table.html">Images and Tables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="image-describe.html">Image Captions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chunking/index.html">Chunking &amp; Serialization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chunking/chunking.html">Why Chunking?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chunking/hybrid.html">Hybrid Chunking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chunking/serialization.html">Serialization</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../rag/index.html">RAG with Docling</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../dpk/index.html">Data Prep Kit (DPK)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dpk/dpk-lab.html">Labs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Data Preparation for Gen AI Applications</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Data Preparation for Gen AI Applications</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Data Preparation for Gen AI Applications</a></li>
    <li><a href="index.html">Conversion</a></li>
    <li><a href="image-table.html">Images and Tables</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Parsing Documents with Images and Tables</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Once you convert an input document into the unified <code>DoclingDocument</code> object, you can then programatically traverse the object tree and extract items like headings, paragraphs, code blocks, images, tables, cells and textual items.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The Docling Python library must be installed as outlined in the previous sections using <code>pip</code> in a Python virtual environment</p>
</li>
<li>
<p>Git CLI to clone the sample data files from GitHub</p>
</li>
<li>
<p>Visual Studio Code, or other editors to edit Python code</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_exporting_tables"><a class="anchor" href="#_lab_exporting_tables"></a>Lab: Exporting Tables</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done it, clone the Git repository containing the sample documents that should be converted, to a folder of your choice.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>git clone https://github.com/RedHatQuickCourses/genai-apps.git</strong></code></pre>
</div>
</div>
</li>
<li>
<p>All the sample input files and code is in a folder called <code>dataprep</code>. Change to this folder in the terminal.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cd genai-apps/dataprep</strong></code></pre>
</div>
</div>
</li>
<li>
<p>If you have previously created a virtual environment and installed Docling, activate the venv.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>source venv/bin/activate</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your prompt should change to indicate that you are now running in an isolated virtual environment.</p>
</div>
</li>
<li>
<p>Inspect the <code>export-tables.py</code> file in VS Code. The input document is in the <code>sample-data/batch</code> folder. The output documents will be placed in the <code>/tmp/export-tables</code> folder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">INPUT_FILE = "sample-data/batch/2206.01062.pdf"
OUTPUT_DIR = "/tmp/export-tables/"</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>main()</code> method, instantiate a default <code>DocumentConverter</code> class instance and convert the input document:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
    doc_converter = DocumentConverter()

    conv_res = doc_converter.convert(input_file)
...</code></pre>
</div>
</div>
</li>
<li>
<p>On the <code>DoclingDocument</code> object, Docling provides a <code>tables</code> method that returns a list of <code>TableItem</code> objects representing all the tables in the document. We take advantage of Docling&#8217;s integration with the popular <code>Pandas</code> library to export a <code>DataFrame</code> object that we can convieniently query and manipulate.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
for table_ix, table in enumerate(<strong>conv_res.document.tables</strong>):
    table_df = <strong>table.export_to_dataframe()</strong>
...</code></pre>
</div>
</div>
</li>
<li>
<p>Finally, we export the in-memory representation of the <code>DataFrame</code> objects to a CSV file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
    table_df.to_csv(element_csv_filename)
...</code></pre>
</div>
</div>
</li>
<li>
<p>Run the program. You can safely ignore any warnings emitted. You should see some table output in markdown format.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>python3 export-tables.py</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Once the program completes, you should see CSV files in the <code>/tmp/export-tables</code> folder corresponding to each of the tables in the document with a <code>*.csv</code> extension.</p>
<div class="imageblock">
<div class="content">
<img src="_images/export-tables.png" alt="export tables">
</div>
<div class="title">Figure 1. Tables exported to CSV files</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_exporting_images_and_image_snapshots"><a class="anchor" href="#_lab_exporting_images_and_image_snapshots"></a>Lab: Exporting Images and Image Snapshots</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inspect the code in the <code>export-images.py</code> file. The input file for this lab is <code>sample-data/penrose.pdf</code>, a document that has a number of embedded images. The images are extracted and saved to the <code>/tmp/export-images</code> folder after processing.</p>
</li>
<li>
<p>In the <code>main()</code> method, we customize the pipeline by asking Docling to generate images of each page in the input document as well as extract images from it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
    pipeline_options = PdfPipelineOptions()
    pipeline_options.images_scale = 2.0
    pipeline_options.generate_page_images = True
    pipeline_options.generate_picture_images = True
...</code></pre>
</div>
</div>
</li>
<li>
<p>Once the document is converted, we iterate over each page in the document, and take a snapshot image of each page and save it in the <code>/tmp/export-images</code> folder. Once again, Docling&#8217;s native integration with the popular Python <code>Pillow</code> library provides a nice convienient abstraction for us to export the image objects to different formats.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
    for page_no, page in <strong>conv_res.document.pages.items()</strong>:
        page_no = page.page_no
        page_image_filename = output_path / f"{out_file_name}-page-{page_no}.png"

        with page_image_filename.open("wb") as fp:
            <strong>page.image.pil_image.save(fp, format="PNG")</strong>
...</code></pre>
</div>
</div>
</li>
<li>
<p>Next, we iterate over the hierarchial tree of nested objects in the <code>DoclingDocument</code> object and extract images (<code>PictureItem</code> elements) from it. We serialize each of the extracted images in the <code>/tmp/export-images</code> folder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
for element, _level in conv_res.document.<strong>iterate_items()</strong>:
    if isinstance(element, <strong>PictureItem</strong>):
        picture_counter += 1
        element_image_filename = (
            output_path / f"{out_file_name}-picture-{picture_counter}.png"
        )
...</code></pre>
</div>
</div>
</li>
<li>
<p>Continue using the virtual environment from the previous lab. If you are not in the virtual environment, active it and then run the <code>export-images.py</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>python3 export-images.py</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the extracted page images and the individual images in the document are exported in the <code>/tmp/export-images</code> folder.</p>
<div class="imageblock">
<div class="content">
<img src="_images/export-images.png" alt="export images">
</div>
<div class="title">Figure 2. Images exported to PNG files</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="custom.html">Customizing</a></span>
  <span class="next"><a href="image-describe.html">Image Captions</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
